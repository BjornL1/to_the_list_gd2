{% extends 'base.html' %}

{% block landing_page_image %}
<!-- Empty block to override the landing page image -->
{% endblock landing_page_image %}

{% block title %}
    <title>Items for {{ shopping_list.name }}</title>
{% endblock %}

{% block content %}


<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>Items for {{ shopping_list.name }}</title>
    <style>
        /* Define your CSS styles for checkboxes and labels */
        .checkbox-label {
            display: inline-block;
            margin-right: 10px;
            /* Adjust as needed */
        }
    </style>
    <!-- JavaScript function for confirmation message -->
    <script>
        function confirmClone() {
            var result = confirm("Clone this list? Yes/Cancel");
            if (result) {
                // If the user clicks "Yes", proceed with the clone action
                return true;
            } else {
                // If the user clicks "Cancel", do nothing
                return false;
            }
        }
    </script>

    <script>
        function confirmDelete(listName) {
            var result = confirm("Do you really want to delete " + listName + "?");
            if (result) {
                return true;
            } else {
                return false;
            }
        }
    </script>

    <script>
        function confirmRename(listName) {
            var result = confirm("Do you really want to rename this listeee?");
            if (result) {
                return true;
            } else {
                return false;
            }
        }
    </script>


</head>

<body>
    <div class="listitems-header">
    <h1 class="listitems-header">Items for {{ shopping_list.name }}</h1>
    </div>
    <ul>
        {% for item in items %}
        <li>
            <!-- Checkbox input for each item -->
            <input type="checkbox" id="item_{{ item.id }}" name="item_{{ item.id }}"
                {% if item.is_done %}checked{% endif %}>
            <!-- Label for the checkbox, displaying the item name and quantity -->
            <label for="item_{{ item.id }}" class="checkbox-label">{{ item.name }} - Quantity:
                {{ item.quantity }}</label>
        </li>
        {% endfor %}
    </ul>

    <a href="{% url 'add_item' list_id=shopping_list.id %}">Add Item</a>

    <!-- Clone List Button -->
    <form method="post" action="{% url 'clone' list_id=shopping_list.id %}">
        {% csrf_token %}
        <button type="submit" onclick="return confirmClone()">Clone List</button>
    </form>

    <!-- Rename List Button -->
    {% if is_owner %}
    <form method="post" action="{% url 'rename' list_id=shopping_list.id %}">
        {% csrf_token %}
        <button type="submit">Rename List</button>
    </form>
    {% else %}
    <button type="button" disabled>Rename List</button>
    <span id="infoIcon">ℹ️</span>
    <p><i>Only the owner can rename this list.</i></p>
    {% endif %}

    <!-- Delete button -->
    <form method="post" action="{% url 'delete' list_id=shopping_list.id %}"
        onsubmit="return confirmDelete('{{ shopping_list.name }}')">
        {% csrf_token %}
        <button type="submit">Delete</button>
    </form>

    <script>
        // Function to display information message when clicking the info icon
        document.getElementById('infoIcon').addEventListener('click', function () {
            alert('Only the owner can rename this list.');
        });
    </script>

    <script>
        // Add event listener to each item checkbox
        document.addEventListener("DOMContentLoaded", function () {
            var itemList = document.querySelectorAll('input[type="checkbox"]');
            itemList.forEach(function (checkbox) {
                checkbox.addEventListener('change', function () {
                    var itemId = checkbox.id.split('_')[1]; // Extract item ID from checkbox ID
                    toggleItemDone(itemId);
                });
            });
        });

        // Define the getCookie function
        function getCookie(name) {
            var cookieValue = null;
            if (document.cookie && document.cookie !== '') {
                var cookies = document.cookie.split(';');
                for (var i = 0; i < cookies.length; i++) {
                    var cookie = cookies[i].trim();
                    // Check if the cookie name matches the parameter
                    if (cookie.substring(0, name.length + 1) === (name + '=')) {
                        cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                        break;
                    }
                }
            }
            return cookieValue;
        }

        // Function to toggle "done" status of an item
        function toggleItemDone(itemId) {
            // Send AJAX request to update "done" status
            fetch(`/toggle-item-done/${itemId}/`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'X-CSRFToken': getCookie('csrftoken')
                    },
                })
                .then(response => response.json())
                .then(data => {
                    // Update UI based on response
                    if (data.status === 'success') {
                        console.log('Item status toggled successfully.');
                        // Toggle "done" status
                        var itemLabel = document.querySelector(`label[for="item_${itemId}"]`);
                        itemLabel.classList.toggle('done');
                    } else {
                        // Handle error
                        console.error('Error:', data.error);
                    }
                })
                .catch(error => {
                    console.error('Error:', error);
                });
        }
    </script>

</body>

</html>
{% endblock %}
<!--

<ul>
        {% for item in items %}
        <li>
             Checkbox input for each item 
            <input type="checkbox" id="item_{{ item.id }}" name="item_{{ item.id }}">
       Label for the checkbox, displaying the item name and quantity --
            <label for="item_{{ item.id }}" class="checkbox-label">{{ item.name }} - Quantity:
                {{ item.quantity }}</label>
        </li>
        {% endfor %}
    </ul>

    
Add the messages code here 
{% if messages %}
<ul class="messages">
    {% for message in messages %}
    <li>{{ message }}</li>
    {% endfor %}
</ul>
{% endif %}


  Display error message if the user is not authorized to rename 
 {% if not_authorized_message %}
 <p>{{ not_authorized_message }}</p>
 {% else %}
 <h1>Rename "{{ shopping_list.name }}"</h1>
 <form id="renameForm" method="post" action="{% url 'rename' list_id=shopping_list.id %}">
     {% csrf_token %}
     <label for="new_name">New Name for:</label>
     <input type="text" id="new_name" name="new_name" required>
     <button id="renameButton" type="submit" onclick="return confirmRename('{{ shopping_list.name }}')">Rename List</button>
 </form>
 {% endif %}


 Rename List Button
{% if is_owner %}
<form method="post" action="{% url 'rename' list_id=shopping_list.id %}">
    {% csrf_token %}
    <button type="submit" onclick="return confirmRename()">Rename List</button>
</form>
{% else %}
<button type="button" disabled>Rename List</button>
<p><i>Only the owner can rename this list.</i></p>
{% endif %}

-->