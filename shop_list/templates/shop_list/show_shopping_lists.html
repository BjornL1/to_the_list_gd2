{% extends 'base.html' %}

{% block landing_page_image %}
<!-- Empty block to override the landing page image -->
{% endblock landing_page_image %}

{% block title %}
<title>Items for {{ shopping_list.name }}</title>
{% endblock %}

{% block content %}



<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>Shopping Lists</title>
    <style>
        .toggle-container {
            position: relative;
            display: inline-block;
        }

        .toggle-shape {
            position: absolute;
            top: 50%;
            transform: translateY(-50%);
            width: 100px;
            /* Adjust width as needed */
            height: 100px;
            /* Adjust height as needed */
            background-color: blue;
        }

        .public .toggle-shape {
            background-color: green;
        }

        .private .toggle-shape {
            background-color: yellow;
        }

        .private {
            color: black;
            /* Change to the color you want for private status */
        }

        .public {
            color: rgb(10, 153, 13);
            /* Change to the color you want for public status */
        }

        .bottom-right-button {
            /* Position the button 2rem from the bottom and 2rem from the right */
            bottom: 15%;
            right: 20%;
        }
    </style>
</head>

<body>
    <div class="container">
        <h1 class="custom-container">Shopping Lists</h1>
        <div class="row">
            {% for shopping_list, owner_username, done_count in lists_with_usernames %}
            <div class="col-md-6 col-lg-4">
                <div class="card h-100">
                    <div class="card-body d-flex flex-column">
                        <h5 class="card-title">
                            <a href="{% url 'show_items' list_id=shopping_list.id %}">{{ shopping_list.name }}</a>
                        </h5>
                        <p class="card-text">Created by: {{ owner_username }}</p>
                        <p class="card-text">Clone Count: {{ shopping_list.clone_count }}</p>
                        <p>Items: {{ done_count }}/{{ shopping_list.items.count }} Done</p>
                        <!-- Public/Private text and edit button -->
                        <div class="d-flex align-items-end">
                            {% if shopping_list.owner == request.user %}
                            <!-- If the list belongs to the logged-in user, show toggle slider -->
                            <input type="range"
                                class="toggle-slider {% if shopping_list.is_private %}private{% else %}public{% endif %}"
                                data-list-id="{{ shopping_list.id }}" min="0" max="1" step="1">
                            <span class="status-text {% if shopping_list.is_private %}private{% else %}public{% endif %}">
                                {% if shopping_list.is_private %}Private{% else %}Public{% endif %}
                            </span>
                            {% else %}
                            <!-- If the list is public and belongs to another user, show "External" text -->
                            <span class="status-text">External</span>
                            {% endif %}
    
                            <!-- Add margin between public/private text and edit button -->
                            <div style="margin-left: 10px;"></div>
                            <div class="d-flex justify-content-between align-items-end">
                                <!-- Edit button -->
                                {% if shopping_list.owner == request.user %}
                                <a href="{% url 'edit' shopping_list.id %}"
                                    class="btn btn-secondary position-absolute bottom-right-button">Edit</a>
                                {% else %}
                                <a href="{% url 'clone' shopping_list.id %}"
                                    class="btn btn-secondary position-absolute bottom-right-button">Clone</a>
                                {% endif %}
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            {% endfor %}
        </div>
    </div>

    <script>
        document.addEventListener("DOMContentLoaded", function () {
            var toggleSliders = document.querySelectorAll('.toggle-slider');
            toggleSliders.forEach(function (slider) {
                var listId = slider.dataset.listId;
                slider.value = slider.classList.contains('private') ? 1 : 0;
            });
        });

        // Add event listener to toggle sliders
        document.addEventListener("change", function (event) {
            console.log('Change event triggered');
            if (event.target && event.target.classList.contains('toggle-slider')) {
                console.log('Toggle slider clicked');
                var listId = event.target.dataset.listId;
                toggleList(listId, event.target.value);

                var textElement = event.target.parentElement.querySelector('.status-text');
                if (textElement) {
                    // Update the text based on the toggle status
                    textElement.textContent = event.target.value === '1' ? 'Private' : 'Public';
                } else {
                    console.error('Status text element not found.');
                }
            }
        });

        function toggleList(listId) {
            console.log('Toggling list with ID:', listId);
            // Simulate toggling the privacy status
            console.log('Privacy status toggled successfully!');

            // Fetch request to toggle the privacy status
            var csrftoken = getCookie('csrftoken');
            fetch(`/toggle-list-status/${listId}/`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'X-CSRFToken': csrftoken
                    },
                })
                .then(response => response.json())
                .then(data => {
                    if (data.status === 'success') {
                        // Toggle the color of the button
                        var slider = document.querySelector(`.toggle-slider[data-list-id="${listId}"]`);
                        slider.classList.toggle('public');
                        slider.classList.toggle('private');
                    } else {
                        // Handle error
                        console.error('Error:', data.error);
                    }
                })
                .catch(error => {
                    console.error('Error:', error);
                });
        }

        function getCookie(name) {
            var cookieValue = null;
            if (document.cookie && document.cookie !== '') {
                var cookies = document.cookie.split(';');
                for (var i = 0; i < cookies.length; i++) {
                    var cookie = cookies[i].trim();
                    // Does this cookie string begin with the name we want?
                    if (cookie.substring(0, name.length + 1) === (name + '=')) {
                        cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                        break;
                    }
                }
            }
            return cookieValue;
        }
    </script>

</body>

</html>
{% endblock %}
<!--

<ul>
        {% for shopping_list, owner_username in lists_with_usernames %}
        <li>
            <span class="list-container">
                <a class="text-warning"
                    href="{% url 'show_items' list_id=shopping_list.id %}">{{ shopping_list.name }}</a><br>
                <input type="range"
                    class="toggle-slider {% if shopping_list.is_private %}private{% else %}public{% endif %}"
                    data-list-id="{{ shopping_list.id }}" min="0" max="1" step="1">
                <span class="status-text {% if shopping_list.is_private %}private{% else %}public{% endif %}">
                    {% if shopping_list.is_private %}Private{% else %}Public{% endif %}
                </span>
            </span>
            <span>Created by: {{ owner_username }}</span>
            <span>Clone Count: {{ shopping_list.clone_count }}</span>
        </li>
        <div>
            <--<h2>{{ shopping_list.name }}</h2>-->
<!--<p>Owner: {{ shopping_list.owner }}</p>-->
<!-- Add link to edit page --
            <a href="{% url 'edit' shopping_list.id %}">Edit</a>
        </div>
        {% endfor %}
    </ul>













    
{% if shopping_list.is_private %}Private{% else %}Public{% endif %}


// Function to toggle between private and public status
function toggleListStatus(listId, status) {
  // Make a POST request to updateListStatus endpoint
  fetch(`/updateListStatus/${listId}`, {
    method: 'POST',
    headers: {
      'Content-Type': 'application/json'
    },
    body: JSON.stringify({ status: status })
  })
  .then(response => {
    if (response.ok) {
      // Status updated successfully, update UI or show success message
      console.log('List status updated successfully');
    } else {
      // Handle error response
      console.error('Failed to update list status');
    }
  })
  .catch(error => {
    console.error('Error updating list status:', error);
  });
}

// Function to fetch and display user's list
function getUserList() {
  // Make a GET request to userList endpoint
  fetch('/userList')
  .then(response => {
    if (response.ok) {
      return response.json(); // Assuming response is JSON, adapt as needed
    } else {
      // Handle error response
      throw new Error('Failed to fetch user list');
    }
  })
  .then(data => {
    // Display user's list in the UI
    console.log('User List:', data);
  })
  .catch(error => {
    console.error('Error fetching user list:', error);
  });
}
    









code to be inserted later

        function toggleList(listId) {
            var csrftoken = getCookie('csrftoken');
            fetch(`/toggle-list-status/${listId}/`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'X-CSRFToken': csrftoken
                    },
                })
                .then(response => response.json())
                .then(data => {
                    try {
                        JSON.parse(data);
                    } catch (error) {
                        console.log('Error parsing JSON:', error, data);
                    }
                    if (data.status === 'success') {
                        // Toggle the color of the button
                        var button = document.querySelector(`.toggle-button[data-list-id="${listId}"]`);
                        button.classList.toggle('public');
                        button.classList.toggle('private');
                        // Update button text
                        button.textContent = data.is_public ? 'Public' : 'Private';
                    } else {
                        // Handle error
                        console.error('Error:', data.error);
                    }
                })
                .catch(error => {
                    console.error('Error:', error);
                });
        }

        function getCookie(name) {
            var cookieValue = null;
            if (document.cookie && document.cookie !== '') {
                var cookies = document.cookie.split(';');
                for (var i = 0; i < cookies.length; i++) {
                    var cookie = cookies[i].trim();
                    if (cookie.substring(0, name.length + 1) === (name + '=')) {
                        cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                        break;
                    }
                }
            }
            return cookieValue;
        }
  







function toggleList(listId) {
            // Your JavaScript logic to toggle the privacy of the shopping list goes here
            // You can use AJAX to send a request to your Django view to update the list's privacy status
            console.log('List ID:', listId);
 } // For testing purposes




{% for shopping_list in user_shopping_lists %}
        <li>
            <a href="{% url 'show_items' list_id=shopping_list.id %}">{{ shopping_list.name }}</a><br>
            <span>Created by: {{ request.user.username }}</span>
        </li>
        {% endfor %}



    {% for shopping_list, owner_username in lists_with_usernames %}
        <li>
            <a href="{% url 'show_items' list_id=shopping_list.id %}">{{ shopping_list.name }}</a><br>
            <span>Created by: {{ owner_username }}</span>
        </li>
        {% endfor %}
    
    
    
    {% for list in lists %}
        <a href="{% url 'show_items' list_id=list.id %}">{{ list.name }}</a><br>
    {% endfor %}
 {% for list in lists %}
            <li>{{ list.name }}</li>
        {% endfor %}







<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Shopping Lists</title>
</head>
<body>
    <h1>Shopping Lists</h1>
    
    <ul>
    {% for shopping_list in shopping_lists %}
        <li><a href="{% url 'show_items' list_id=shopping_list.id %}">{{ shopping_list.name }}</a></li>
    {% endfor %}
    </ul>
</body>
</html>
-->